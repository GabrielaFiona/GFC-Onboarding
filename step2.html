<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Onboarding - Build Structure</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;600&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">
</head>

<body class="step2">

<!-- FLOATING INVOICE WIDGET (shared) -->
<div id="floating-widget" class="collapsed">
    <div class="fw-header" onclick="toggleWidget()">
        <span>ESTIMATED TOTAL</span>
        <span id="fw-header-total">$0</span>
    </div>
    <div class="fw-content">
        <div id="fw-items">
            <p class="empty-state">Select a package to start...</p>
        </div>
        <div class="fw-total">
            <span>Total Investment</span>
            <span id="fw-full-total">$0</span>
        </div>
        <div class="fw-deposit">
            50% Deposit: <span id="fw-deposit">$0</span>
        </div>
    </div>
</div>

<!-- PROGRESS BAR (4 steps) -->
<div class="progress-header">
    <div class="progress-bar">
        <div class="progress-line-bg"></div>
        <div class="progress-line-fill" id="progress-fill" style="width:33.33%;"></div>

        <div class="step-indicator completed" id="step-ind-1">
            1
            <div class="step-label">Business Goals</div>
        </div>
        <div class="step-indicator active" id="step-ind-2">
            2
            <div class="step-label">Build Structure</div>
        </div>
        <div class="step-indicator" id="step-ind-3">
            3
            <div class="step-label">Action Plan</div>
        </div>
        <div class="step-indicator" id="step-ind-4">
            4
            <div class="step-label">Finalize Plan</div>
        </div>
    </div>
</div>

<div class="container">
    <div id="step-2" class="step-section active">

        <div class="intro-block">
            <h1>Build Structure</h1>
            <p>
                Step 2 is where we define the scope: choose a package first, then we’ll layer in branding.
            </p>

            <div class="included-all">
                <div class="included-title">Included in all website packages</div>
                <ul>
                    <li>1 revision</li>
                    <li>Mobile-optimized development</li>
                    <li>Google Analytics</li>
                    <li>Basic SEO</li>
                    <li>Basic copywriting</li>
                    <li>Free subdomain / URL from Netlify</li>
                </ul>
            </div>
        </div>

        <!-- PACKAGES (COLLAPSIBLE) -->
        <section class="collapsible" data-collapsible data-key="step2-packages">
            <button class="collapsible-header" type="button" data-collapsible-header>
                <div class="collapsible-header-left">
                    <div class="collapsible-title">Website Packages</div>
                    <div class="collapsible-subtitle">Your package choice sets the baseline for the rest of the build.</div>
                </div>
                <span class="collapsible-chevron" aria-hidden="true">▾</span>
            </button>

            <div class="collapsible-body">
                <div class="collapsible-inner">
                    <div class="package-grid">

                        <div class="package-card"
                             data-package-id="basic"
                             onclick="selectPackage('basic','Basic Website',1500,2,425,150,this); handlePackageSelected();">
                            <div class="package-top">
                                <div class="package-name">Basic Website</div>
                                <div class="package-price">$1,500</div>
                            </div>
                            <div class="package-meta">2 pages · 1 contact form</div>
                            <p class="package-desc">
                                Great for online business cards, photo galleries, personal announcements, or coming-soon pages.
                            </p>
                            <ul class="package-list">
                                <li>2 pages</li>
                                <li>1 contact form</li>
                            </ul>
                            <div class="package-duration">Duration: 1–2 weeks</div>
                        </div>

                        <div class="package-card"
                             data-package-id="standard"
                             onclick="selectPackage('standard','Standard Business Website',2500,5,400,175,this); handlePackageSelected();">
                            <div class="package-top">
                                <div class="package-name">Standard Business Website</div>
                                <div class="package-price">$2,500</div>
                            </div>
                            <div class="package-meta">5 pages · 3 embeds · contact form</div>
                            <p class="package-desc">
                                Good for local businesses who need credibility and searchability (restaurants, contractors, boutiques).
                            </p>
                            <ul class="package-list">
                                <li>5 pages</li>
                                <li>Contact form</li>
                                <li>3 embeds: Google Reviews, Google Maps, Instagram Feed</li>
                                <li>Interactive design features + custom branding</li>
                            </ul>
                            <div class="package-duration">Duration: 3–4 weeks</div>
                        </div>

                        <div class="package-card"
                             data-package-id="advanced"
                             onclick="selectPackage('advanced','Advanced Business Website',4500,10,375,200,this); handlePackageSelected();">
                            <div class="package-top">
                                <div class="package-name">Advanced Business Website</div>
                                <div class="package-price">$4,500</div>
                            </div>
                            <div class="package-meta">10 pages · integrations · 5 embeds</div>
                            <p class="package-desc">
                                Perfect for complex business needs like hotels, rentals, and e-commerce businesses.
                            </p>
                            <ul class="package-list">
                                <li>10 pages</li>
                                <li>System integrations (bookings, scheduling, e-commerce, etc.)</li>
                                <li>Optional blog</li>
                                <li>5 embeds (includes booking/scheduling system, chatbot, Google Reviews, Google Maps, Instagram Feed)</li>
                                <li>Interactive design features, forms, and custom branding</li>
                            </ul>
                            <div class="package-duration">Duration: 5–6 weeks</div>
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <!-- BRANDING (COLLAPSIBLE) -->
        <section id="brandingSection" class="collapsible collapsed" data-collapsible data-key="step2-branding">
            <button class="collapsible-header" type="button" data-collapsible-header>
                <div class="collapsible-header-left">
                    <div class="collapsible-title">Branding</div>
                    <div class="collapsible-subtitle">Choose what you already have + what you want to add.</div>
                </div>
                <span class="collapsible-chevron" aria-hidden="true">▾</span>
            </button>

            <div class="collapsible-body">
                <div class="collapsible-inner">

                    <div class="notice" id="brandingLockedNotice">
                        Select a website package above to unlock branding options.
                    </div>

                    <div id="brandingUnlocked" class="hidden">
                        <div class="branding-toggle-row">
                            <div class="branding-question">
                                Do you have branding materials already provided?
                            </div>

                            <div class="segmented-control" role="radiogroup" aria-label="Branding provided">
                                <input class="seg-input" type="radio" name="brandingProvided" id="brandingProvidedYes" value="yes">
                                <label class="seg-label" for="brandingProvidedYes">Yes</label>

                                <input class="seg-input" type="radio" name="brandingProvided" id="brandingProvidedNo" value="no">
                                <label class="seg-label" for="brandingProvidedNo">No</label>
                            </div>
                        </div>

                        <!-- YES PANEL -->
                        <div id="brandingProvidedPanel" class="branding-panel hidden">
                            <div class="form-grid">
                                <div class="full-width">
                                    <label>Upload Branding Materials (Optional)</label>
                                    <input type="file" id="brandingUploads" multiple>
                                    <div class="helper-text">Uploads aren’t saved automatically (local files). If you refresh, you may need to re-select them.</div>
                                </div>

                                <div class="full-width">
                                    <label>What do you already have?</label>
                                    <div class="mini-help">Examples: logos, brand colors, links, fonts, brand tone, brand guide PDF, photos, social links, etc.</div>
                                    <textarea id="brandingProvidedNotes" class="save-me" rows="3" placeholder="List what you already have and any links or notes."></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- NO PANEL -->
                        <div id="brandingNotProvidedPanel" class="branding-panel hidden">
                            <div class="helper-text" style="margin:0;">
                                No worries — you can add branding services below (bundle pricing applies when a package is selected).
                            </div>
                        </div>

                        <!-- BRANDING OPTIONS -->
                        <div class="branding-options">
                            <div class="branding-options-title">Branding Services</div>

                            <div class="brand-kit-card" id="brand-kit-bar" onclick="toggleBrandKit(this)">
                                <div class="kit-details">
                                    <div class="kit-title">Brand Kit</div>
                                    <div class="kit-features">
                                        Logo Suite, Brand Colors &amp; Typography, Brand Persona &amp; Target Customer.
                                    </div>
                                    <div class="kit-note">
                                        <strong>Bundle price</strong> is shown automatically when a package is selected.
                                    </div>
                                </div>

                                <div class="kit-price-block">
                                    <span class="og-price">$500</span>
                                    <span class="discount-label">BUNDLE RATE</span>
                                    <div class="final-price">$500</div>
                                </div>
                            </div>

                            <div class="addons-list" style="margin-top:14px;">
                                <div class="addon-pill brand-addon"
                                     data-addon-id="single_logo"
                                     onclick="toggleAddon('single_logo','Single Logo',300,this)">
                                    <span class="addon-name">Single Logo</span>
                                    <span class="addon-price">+ $300</span>
                                </div>

                                <div class="addon-pill brand-addon"
                                     id="customBrandingPill"
                                     onclick="toggleCustomBranding(this)">
                                    <span class="addon-name">Custom Branding Service</span>
                                    <span class="addon-price">+ Custom</span>
                                </div>
                            </div>

                            <div id="customBrandingPanel" class="custom-panel hidden">
                                <div class="form-grid">
                                    <div>
                                        <label>Custom Service Name</label>
                                        <input type="text" id="customBrandingName" class="save-me" placeholder="e.g. Brand Strategy Session">
                                    </div>
                                    <div>
                                        <label>Custom Service Price ($)</label>
                                        <input type="number" id="customBrandingPrice" class="save-me" placeholder="0" min="0" step="1">
                                    </div>
                                    <div class="full-width">
                                        <div class="helper-text">This will appear in the quote widget as a line item once a price is entered.</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <div class="step-nav-buttons" style="margin-top:40px; display:flex; justify-content:space-between;">
            <button class="btn btn-secondary" type="button" onclick="nextStep(1)">
                &larr; Back: Business Goals
            </button>
            <button class="btn btn-primary" type="button" onclick="nextStep(3)">
                Next: Action Plan &rarr;
            </button>
        </div>

    </div>
</div>

<script src="script.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function () {
    if (window.loadState) window.loadState();

    if (window.state && window.state.package && window.state.package.id) {
        const selected = document.querySelector('.package-card[data-package-id="' + window.state.package.id + '"]');
        if (selected) selected.classList.add('selected');
        handlePackageSelected(true);
    }

    if (window.updateBrandKitDisplay) window.updateBrandKitDisplay();

    if (window.state && Array.isArray(window.state.addons)) {
        window.state.addons.forEach(function (addon) {
            const pill = document.querySelector('.addon-pill[data-addon-id="' + addon.id + '"]');
            if (pill) pill.classList.add('selected');
        });

        const custom = window.state.addons.find(a => a.id === 'custom_branding');
        if (custom) {
            const pill = document.getElementById('customBrandingPill');
            if (pill) pill.classList.add('selected');
            const panel = document.getElementById('customBrandingPanel');
            if (panel) panel.classList.remove('hidden');
            const nameEl = document.getElementById('customBrandingName');
            const priceEl = document.getElementById('customBrandingPrice');
            if (nameEl && custom.name) nameEl.value = custom.name.replace(/^Custom:\s*/, '');
            if (priceEl && custom.price != null) priceEl.value = custom.price;
        }
    }

    restoreBrandingProvided();
    initLocalAutosave(['brandingProvidedNotes','customBrandingName','customBrandingPrice']);

    if (window.calculateTotal) window.calculateTotal();
});

function handlePackageSelected(isRestore) {
    const notice = document.getElementById('brandingLockedNotice');
    const unlocked = document.getElementById('brandingUnlocked');
    if (notice) notice.classList.add('hidden');
    if (unlocked) unlocked.classList.remove('hidden');

    const branding = document.getElementById('brandingSection');
    if (branding) {
        branding.classList.remove('disabled');
        branding.classList.remove('collapsed');
        const header = branding.querySelector('[data-collapsible-header]');
        if (header) header.setAttribute('aria-expanded', 'true');
        try { localStorage.setItem('collapsible:step2-branding', 'open'); } catch (e) {}
    }

    if (window.updateBrandKitDisplay) window.updateBrandKitDisplay();
    if (window.initCollapsibles && !isRestore) window.initCollapsibles();
}

function restoreBrandingProvided() {
    const saved = localStorage.getItem('brandingProvided');
    if (!saved) return;

    const yes = document.getElementById('brandingProvidedYes');
    const no = document.getElementById('brandingProvidedNo');
    if (saved === 'yes' && yes) yes.checked = true;
    if (saved === 'no' && no) no.checked = true;

    updateBrandingPanels(saved);
}

function updateBrandingPanels(value) {
    const yesPanel = document.getElementById('brandingProvidedPanel');
    const noPanel = document.getElementById('brandingNotProvidedPanel');

    if (yesPanel) yesPanel.classList.toggle('hidden', value !== 'yes');
    if (noPanel) noPanel.classList.toggle('hidden', value !== 'no');
}

document.addEventListener('change', function (e) {
    if (e.target && e.target.name === 'brandingProvided') {
        localStorage.setItem('brandingProvided', e.target.value);
        updateBrandingPanels(e.target.value);
    }
});

function toggleCustomBranding(pill) {
    const panel = document.getElementById('customBrandingPanel');
    const isSelected = pill.classList.toggle('selected');
    if (panel) panel.classList.toggle('hidden', !isSelected);

    if (!isSelected) {
        if (window.removeAddonById) window.removeAddonById('custom_branding');
        return;
    }

    updateCustomBrandingAddon();
}

function updateCustomBrandingAddon() {
    const pill = document.getElementById('customBrandingPill');
    if (!pill || !pill.classList.contains('selected')) return;

    const nameEl = document.getElementById('customBrandingName');
    const priceEl = document.getElementById('customBrandingPrice');

    const nameRaw = nameEl ? nameEl.value.trim() : '';
    const name = nameRaw ? `Custom: ${nameRaw}` : 'Custom Branding Service';
    const price = priceEl ? Number(priceEl.value) : 0;

    if (!price || price <= 0) {
        if (window.removeAddonById) window.removeAddonById('custom_branding');
        return;
    }

    if (window.upsertAddon) window.upsertAddon('custom_branding', name, price);
}

document.addEventListener('input', function (e) {
    if (e.target && (e.target.id === 'customBrandingName' || e.target.id === 'customBrandingPrice')) {
        updateCustomBrandingAddon();
    }
});

function initLocalAutosave(ids) {
    ids.forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;

        const saved = localStorage.getItem(id);
        if (saved !== null) el.value = saved;

        const handler = () => localStorage.setItem(id, el.value);
        el.addEventListener('input', handler);
        el.addEventListener('change', handler);
    });
}
</script>

</body>
</html>
